# üéØ AI Agent Mission: Event & Market System Consolidation

‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ú ‡¶π‡¶≤‡ßã Plokymarket-‡¶è‡¶∞ Event ‡¶è‡¶¨‡¶Ç Market creation ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ï‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡¶∂‡¶®-‡¶∞‡ßá‡¶°‡¶ø **Service Layer Architecture**-‡¶è ‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞ ‡¶ï‡¶∞‡¶æ‡•§ ‡¶è‡¶á ‡¶Æ‡ßÅ‡¶π‡ßÇ‡¶∞‡ßç‡¶§‡ßá ‡¶≤‡¶ú‡¶ø‡¶ï‡¶ó‡ßÅ‡¶≤‡ßã Scattered ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡ßü ‡¶Ü‡¶õ‡ßá, ‡¶Ø‡¶æ ‡¶∞‡¶ø‡¶´‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü‡¶∞ ‡¶ï‡¶∞‡ßá "Instant Go-Live" ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§

## 1. Core Architecture Rules (‡¶≠‡ßÅ‡¶≤ ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ)
- **Modular Isolation:** ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶Æ‡¶°‡¶ø‡¶â‡¶≤‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá‡¶®‡•§
- **Interface First:** ‡¶ï‡ßã‡¶° ‡¶≤‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá `src/types/market-system.ts` ‡¶ö‡ßá‡¶ï ‡¶¨‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®‡•§
- **No Deletion:** ‡¶ï‡ßã‡¶®‡ßã ‡¶è‡¶ï‡ßç‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡¶ø‡¶Ç API ‡¶∞‡ßÅ‡¶ü ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ, ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡ßá ‡¶Ü‡¶®‡¶¨‡ßá‡¶®‡•§
- **Transaction Safety:** ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶∂‡¶®‡¶ó‡ßÅ‡¶≤‡ßã `supabase.rpc` ‡¶¨‡¶æ ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶®‡ßá ‡¶∞‡¶æ‡¶ñ‡¶¨‡ßá‡¶®‡•§

## 2. Entity Relationship Foundation
- **Event (Container):** ‡¶¨‡¶æ‡¶∏‡ßç‡¶§‡¶¨ ‡¶ú‡ßÄ‡¶¨‡¶®‡ßá‡¶∞ ‡¶ò‡¶ü‡¶®‡¶æ (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶¨‡¶ø‡¶™‡¶ø‡¶è‡¶≤ ‡ß®‡ß¶‡ß®‡ß¨)‡•§ ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤: `events`.
- **Market (Tradable):** YES/NO ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶∞‡¶Ç‡¶™‡ßÅ‡¶∞ ‡¶ï‡¶ø ‡¶ú‡¶ø‡¶§‡¶¨‡ßá?)‡•§ ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤: `markets`.
- **Relationship:** 1 Event -> N Markets.

## 3. Tech Stack Requirements
- **Backend Service:** `src/lib/services/MarketService.ts` ‡¶è‡¶¨‡¶Ç `EventService.ts`.
- **Realtime:** Supabase Realtime (Walrus setup).
- **Matching Engine:** `orders` ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤‡ßá Initial Liquidity ‡¶∏‡¶ø‡¶°‡¶ø‡¶Ç‡•§

## 4. Step-by-Step Implementation Plan

### Phase 1: Service Layer Extraction (Backend)
1. **EventService:** `app/api/admin/events/create/route.ts` ‡¶•‡ßá‡¶ï‡ßá ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡ßá `lib/services/EventService.ts` ‡¶è ‡¶Æ‡¶æ‡¶á‡¶ó‡ßç‡¶∞‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
2. **MarketService:** `app/api/admin/market-creation/deploy/route.ts` ‡¶•‡ßá‡¶ï‡ßá ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡ßá `lib/services/MarketService.ts` ‡¶è ‡¶Ü‡¶®‡ßÅ‡¶®‡•§
3. **Liquidity Seeding:** `MarketService` ‡¶è‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá `seedInitialOrderbook(marketId, amount)` ‡¶Æ‡ßá‡¶•‡¶° ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ø‡¶æ ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø `orders` ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤‡ßá YES ‡¶è‡¶¨‡¶Ç NO ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶™‡ßç‡¶≤‡ßá‡¶∏ ‡¶ï‡¶∞‡¶¨‡ßá‡•§

### Phase 2: Instant Go-Live Mechanism
- ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ `pending` ‡¶•‡ßá‡¶ï‡ßá `active` ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶≤‡¶ø‡¶ï‡ßÅ‡¶á‡¶°‡¶ø‡¶ü‡¶ø ‡¶¨‡¶ü ‡¶∞‡¶æ‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§
- ‡¶è‡¶ú‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶ï‡¶æ‡¶ú: ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞‡¶™‡¶∞‡¶á ‡¶Ø‡¶æ‡¶§‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá Buy ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá, ‡¶§‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶®‡ßç‡¶§‡¶§ ‡ßß‡ß¶‡ß¶‡¶ü‡¶ø ‡¶ï‡¶∞‡ßá ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡ß´% ‡¶∏‡ßç‡¶™‡ßç‡¶∞‡ßá‡¶°‡ßá ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡ßá ‡¶¨‡¶∏‡¶æ‡¶®‡ßã ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶æ‡•§

### Phase 3: Frontend Sync (Admin & User)
1. **Admin Wizard:** `components/admin/MarketCreationWizard.tsx` ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ø‡¶æ‡¶§‡ßá ‡¶è‡¶ü‡¶ø ‡¶®‡¶§‡ßÅ‡¶® `MarketService` ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá‡•§
2. **Realtime Hook:** `hooks/useMarketsRealtime.ts` ‡¶§‡ßà‡¶∞‡¶ø ‡¶¨‡¶æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ø‡¶æ‡¶§‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü ‡¶§‡ßà‡¶∞‡¶ø‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶§‡¶æ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶õ‡¶æ‡ßú‡¶æ‡¶á ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡ßü‡•§

## 5. Underlying Issues to Fix (Crucial)
- **Field Mismatch:** ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá 'ends_at' ‡¶´‡¶ø‡¶≤‡ßç‡¶°‡¶ü‡¶ø ‡¶Ø‡ßá‡¶® `markets.trading_closes_at` ‡¶è‡¶¨‡¶Ç `events.ends_at` ‡¶â‡¶≠‡ßü‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶•‡¶æ‡¶ï‡ßá‡•§
- **SQL RLS:** ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ø‡ßá `service_role` ‡¶¶‡¶ø‡ßü‡ßá ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶≤‡ßá‡¶ì ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ï‡ßç‡¶∑‡ßá‡¶§‡ßç‡¶∞‡ßá ‡¶Ø‡ßá‡¶® `anon` ‡¶ï‡¶ø ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßá‡•§
- **Hardcoded Keys:** ‡¶∏‡¶¨ ‡¶è‡¶™‡¶ø‡¶Ü‡¶á ‡¶è‡¶®‡ßç‡¶°‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü ‡¶•‡ßá‡¶ï‡ßá ‡¶π‡¶æ‡¶∞‡ßç‡¶°‡¶ï‡ßã‡¶°‡ßá‡¶° ‡¶ï‡ßÄ ‡¶∏‡¶∞‡¶ø‡ßü‡ßá `process.env` ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§

## 6. Verification Steps for Agent
- [ ] Run `tsc --noEmit` to check types.
- [ ] Verify `npm run build`.
- [ ] Test API endpoint via Postman or Script: `node scripts/test_event_api.js`.